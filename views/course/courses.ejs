<%- include('../partials/head.ejs') %>

<body>
    <%- include('../partials/course-navbar.ejs'), { user: user } %>
          
    <div id="searchResultsContainer">
        <!-- Search results will be dynamically populated here -->
    </div>
    <div class="container text-center px-4">
        <h1>Welcome <%= user.fname %>!</h1>
        <div class="course-header mt-5 mb-5 jumbotron" id="dynamic-heading">
            <h1></h1>
        </div>
        <div class="courses row mx-2">
            <% if (courses.length > 0) { %>
                <% courses.forEach((course) => { %>
                    <div class="single-course col-lg-4 col-md-6 mb-5">
                        <div class="card">
                            <img 
                                src="/uploads/<%= course.img %>"
                                alt="Course Image"
                                class="card-img-top" 
                                width="100%" 
                                height="225"
                            />
                            <div class="card-body course-content">
                                <h4 class="card-title fw-bold">
                                    <%= course.title.substring(0, 28) %>
                                </h4>
                                <p class="card-text">
                                    <%= course.description.substring(0, 150) + "..." %>
                                </p>
                                <div class="row mt-3">
                                    <span class="leng col mt-3">
                                        <%= course.lessons.length %> Lesson(s)
                                    </span>
                                    <a 
                                        href="/api/course/<%= course.id %>" 
                                        class="col btn btn-primary"
                                    >
                                        View Course
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }) %>
            <% } else { %>
                <div style="margin: auto;" class="py-5">
                    <h2 class="py-5">
                        There are no courses to display...
                    </h2>
                </div>
            <% } %>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
    <script src="/views/JS/firebase-auth.js"></script>
</body>
<%- include('../partials/footer.ejs') %>
<script>
    // Define an array of words to cycle through
    var words = ["Explore the best Courses with us...", "From the tech experts....", "All you need from Graphics, programming..."];
      
    // Get a reference to the jumbotron element
    var jumbotron = document.getElementById("dynamic-heading");
      
    // Define a function to update the heading text
    function updateHeading() {
        // Get a random word from the array
        var word = words[Math.floor(Math.random() * words.length)];
          
        // Set the heading text to the random word
        jumbotron.querySelector("h1").textContent = word;
    }
      
    // Call the updateHeading function initially
    updateHeading();
      
    // Call the updateHeading function every minute
    setInterval(updateHeading, 5000);


    // custom.js

    function searchVideos() {
        const query = document.getElementById('searchInput').value.trim();

        if (query === '') {
            // Clear the search results container if the query is empty
            document.getElementById('searchResultsContainer').innerHTML = '';
            return;
        }

        fetch(`/search?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(searchResults => {
                const resultsContainer = document.getElementById('searchResultsContainer');
                resultsContainer.innerHTML = '';

                if (searchResults.length === 0) {
                    const noResultsMessage = document.createElement('p');
                    noResultsMessage.textContent = 'No results found.';
                    resultsContainer.appendChild(noResultsMessage);
                } else {
                    const ul = document.createElement('ul');

                    searchResults.forEach(result => {
                        const li = document.createElement('li');
                        const title = document.createElement('h3');
                        title.textContent = result.title;
                        const videoUrl = document.createElement('p');
                        const link = document.createElement('a');
                        link.href = result.url;
                        link.textContent = result.name;
                        videoUrl.appendChild(link);
                        li.appendChild(title);
                        li.appendChild(videoUrl);
                        ul.appendChild(li);
                    });

                    resultsContainer.appendChild(ul);
                }
            })
            .catch(error => {
                console.error('Error searching videos:', error);
                document.getElementById('searchResultsContainer').textContent = 'An error occurred while searching videos.';
            });
    }

</script>
      
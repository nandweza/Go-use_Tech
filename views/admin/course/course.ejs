<!DOCTYPE html>
<html lang="en">
<%- include('../../partials/head.ejs') %>

<body>
    <%- include('../../partials/admin-navbar.ejs') %>
    <div class="admin">
        <h3 class="dashboard mt-4 mb-2">Access & Update All Courses</h3>
        <hr class="border">
        <div class="all-courses px-5">
            <div class="course-wrapper px-5">
                <div class="p-2 row">
                    <div class="col-md-4">
                        <button class="btn btn-primary btn-lg" id="addLessonBtn">
                            Add Lesson
                        </button>
                    </div>
                    <div class="col-md-4">
                        <a href="/api/course/admin/update/<%= course._id %>">
                            <button class="btn btn-primary btn-lg" id="updateCourseBtn">
                                Update Course
                            </button>
                        </a>
                    </div>
                    <div class="col-md-4">
                        <form 
                            action="/api/course/delete" 
                            method="post"
                        >
                            <button 
                                class="btn btn-lg btn-primary"
                                name="deleteBtn"
                                value="<%= course._id %>"
                                type="submit"
                            >
                                DELETE COURSE
                            </button>
                        </form>
                    </div>
                </div>
                <div class="img-div pt-2">
                    <img src="/uploads/<%= course.img %>" width="100%" height="600">
                </div>
                <span class="p-2"></span>
                <div class="">
                    <h3 class="title-text fw-bold p-2 pb-3">
                        <%= course.title %>
                    </h3>
                    <div class="desc">
                        <p>
                            <%= course.description %>
                        </p>
                    </div>
                </div>
                <hr>
                <div class="py-5">
                    <% course.lessons.forEach((lesson) => { %>
                        <div class="row">
                            <div class="col">
                                <h4>
                                    <%= lesson.title %>
                                </h4>
                            </div>
                            <div class="col">
                                <form 
                                    action="/api/course/lesson/delete"
                                    method="post"
                                >
                                    <input 
                                        type="hidden" 
                                        name="courseId" 
                                        value="<%= course._id %>"
                                    >
                                    <button 
                                        class="btn btn-lg btn-primary"
                                        name="lessonId"
                                        value="<%= lesson._id %>"
                                        type="submit"
                                    >
                                        DELETE LESSON
                                    </button>
                                </form>
                            </div>
                        </div>
                        <div>
                            <video width="500" height="350" controls>
                                <source src="/uploads/<%= lesson.video %>" type="video/mp4">
                            </video>
                        </div>
                        <div>
                            <p>
                                <%= lesson.notes %>
                            </p>
                        </div>
                        <hr>
                    <% }) %>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="addLessonModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">&times;</button>

            <!-- lesson registration form -->
            <form action="" method="post" enctype="multipart/form-data" class="p-5">
                <div class="form-group">
                    <label for="title">Lesson Title:</label>
                    <input type="text" name="title" required class="form-control">
                </div>
                <div class="form-group">
                    <label for="video">Lesson Video:</label>
                    <input type="file" name="video" class="form-control">
                </div>
                <div class="form-group pb-2">
                    <label for="title">Lesson Notes:</label>
                    <textarea
                        class="form-control"
                        name="notes"
                        id="notes"
                        cols="30"
                        rows="10"
                        placeholder=""
                    >
                </textarea>
                </div>
                <button type="submit" class="btn btn-lg btn-primary py-2">Add Lesson</button>
            </form>
            <!-- End of lesson registration form -->
        </div>
    </div>

    <!-- Script to handle modal functionality -->
    <script>
        // Get the modal
        var modal = document.getElementById("addLessonModal");

        // Get the button that opens the modal
        var btn = document.getElementById("addLessonBtn");

        // When the user clicks the button, open the modal
        btn.onclick = function () {
            // Set the form action to the current URL path
            var currentPath = window.location.pathname;
            var form = document.querySelector("#addLessonModal form");
            form.action = currentPath;

            modal.style.display = "block";
        };

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target === modal) {
                modal.style.display = "none";
            }
        };

        // Close the modal when the close button is clicked
        function closeModal() {
            modal.style.display = "none";
        }

        var quill = new Quill('#notes', {
            theme: 'snow'  // 'snow' is one of the Quill themes
        });

        // Get the HTML element where you want to display the formatted content
        var formattedContent = document.getElementById('formatted-content');

         // Listen for changes in the Quill editor
        quill.on('text-change', function(delta, oldDelta, source) {
            // Check if the change was made by the user
            if (source === 'user') {
                // Get the HTML content from Quill
                var htmlContent = quill.root.innerHTML;

                // Set the HTML content to the separate display element
                formattedContent.innerHTML = htmlContent;
            }
        });
    </script>
</body>

</html>
